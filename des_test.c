/*********************************************************************
 * Filename:   des_test.c
 * Author:     Brad Conte (brad AT bradconte.com)
 * Copyright:
 * Disclaimer: This code is presented "as is" without any guarantees.
 * Details:    Performs known-answer tests on the corresponding DES
 implementation. These tests do not encompass the full
 range of available test vectors, however, if the tests
 pass it is very, very likely that the code is correct
 and was compiled properly. This code also serves as
 example usage of the functions.
 *********************************************************************/

/*************************** HEADER FILES ***************************/
#include <stdio.h>
#include <memory.h>
#include "des.h"

static int test_des_ecb(void);
static int test_des_cbc(void);
static int test_tdes_ecb(void);
static int test_tdes_cbc(void);

int main()
{
    //printf("DES test: %s\n", des_test() ? "SUCCEEDED" : "FAILED");

    test_des_ecb();
    test_des_cbc();
    test_tdes_ecb();
    test_tdes_cbc();

    return(0);
}

static int test_des_ecb(void)
{
    int pass = 1;

    BYTE pt[DES_BLOCK_SIZE*8]    = {
        0x01,0x23,0x45,0x67,0x89,0xAB,0xCD,0xE7,
        0x01,0x23,0x45,0x67,0x89,0xAB,0xCD,0xE7,
        0x01,0x23,0x45,0x67,0x89,0xAB,0xCD,0xE7,
        0x01,0x23,0x45,0x67,0x89,0xAB,0xCD,0xE7,
        0x01,0x23,0x45,0x67,0x89,0xAB,0xCD,0xE7,
        0x01,0x23,0x45,0x67,0x89,0xAB,0xCD,0xE7,
        0x01,0x23,0x45,0x67,0x89,0xAB,0xCD,0xE7,
        0x01,0x23,0x45,0x67,0x89,0xAB,0xCD,0xE7};

    BYTE ct[DES_BLOCK_SIZE*8]    = {
        0xc9,0x57,0x44,0x25,0x6a,0x5e,0xd3,0x1d,
        0xc9,0x57,0x44,0x25,0x6a,0x5e,0xd3,0x1d,
        0xc9,0x57,0x44,0x25,0x6a,0x5e,0xd3,0x1d,
        0xc9,0x57,0x44,0x25,0x6a,0x5e,0xd3,0x1d,
        0xc9,0x57,0x44,0x25,0x6a,0x5e,0xd3,0x1d,
        0xc9,0x57,0x44,0x25,0x6a,0x5e,0xd3,0x1d,
        0xc9,0x57,0x44,0x25,0x6a,0x5e,0xd3,0x1d,
        0xc9,0x57,0x44,0x25,0x6a,0x5e,0xd3,0x1d};

    BYTE buf[DES_BLOCK_SIZE*8];

    BYTE key[DES_BLOCK_SIZE]   = {
        0x01,0x23,0x45,0x67,0x89,0xAB,0xCD,0xEF};

    des_alg_ecb(pt,
                DES_BLOCK_SIZE*8,
                buf,
                key,
                DES_ENCRYPT);

    pass = !memcmp(ct, buf, DES_BLOCK_SIZE*8);

    printf("DES ECB test: %s\n", pass ? "SUCCEEDED" : "FAILED");

    return 0;
}

static int test_des_cbc(void)
{
    int pass = 1;

    BYTE pt[DES_BLOCK_SIZE*2]    = {
        0x54,0x69,0x87,0x53,0x21,0x45,0x60,0x45,
        0x54,0x69,0x87,0x53,0x21,0x45,0x60,0x45};

    BYTE ct[DES_BLOCK_SIZE*2]    = {
        0xd1,0x97,0xf8,0xeb,0xf7,0x45,0x51,0xeb,
        0xef,0xab,0xe7,0x7b,0xc0,0xa2,0x50,0xc1};

    BYTE buf[DES_BLOCK_SIZE*2];

    BYTE key[DES_BLOCK_SIZE]    = {
        0x59,0x87,0x42,0x36,0x51,0x45,0x69,0x87};
    BYTE iv[DES_BLOCK_SIZE]     = {
        0xab,0xf7,0x15,0x88,0x09,0xcf,0x4f,0x3c};

    des_alg_cbc(iv,
                pt,
                DES_BLOCK_SIZE*2,
                buf,
                key,
                DES_ENCRYPT);

    pass = !memcmp(ct, buf, DES_BLOCK_SIZE*2);

    printf("DES CBC test: %s\n", pass ? "SUCCEEDED" : "FAILED");

    return 0;
}

static int test_tdes_ecb(void)
{
    int pass = 1;

    BYTE pt[DES_BLOCK_SIZE*8]    = {
        0x54,0x68,0x65,0x20,0x71,0x75,0x66,0x63,
        0x54,0x68,0x65,0x20,0x71,0x75,0x66,0x63,
        0x54,0x68,0x65,0x20,0x71,0x75,0x66,0x63,
        0x54,0x68,0x65,0x20,0x71,0x75,0x66,0x63,
        0x54,0x68,0x65,0x20,0x71,0x75,0x66,0x63,
        0x54,0x68,0x65,0x20,0x71,0x75,0x66,0x63,
        0x54,0x68,0x65,0x20,0x71,0x75,0x66,0x63,
        0x54,0x68,0x65,0x20,0x71,0x75,0x66,0x63
    };
    BYTE ct[DES_BLOCK_SIZE*8]    = {
        0xA8,0x26,0xFD,0x8C,0xE5,0x3B,0x85,0x5F,
        0xA8,0x26,0xFD,0x8C,0xE5,0x3B,0x85,0x5F,
        0xA8,0x26,0xFD,0x8C,0xE5,0x3B,0x85,0x5F,
        0xA8,0x26,0xFD,0x8C,0xE5,0x3B,0x85,0x5F,
        0xA8,0x26,0xFD,0x8C,0xE5,0x3B,0x85,0x5F,
        0xA8,0x26,0xFD,0x8C,0xE5,0x3B,0x85,0x5F,
        0xA8,0x26,0xFD,0x8C,0xE5,0x3B,0x85,0x5F,
        0xA8,0x26,0xFD,0x8C,0xE5,0x3B,0x85,0x5F
    };
    BYTE buf[DES_BLOCK_SIZE*8];
    BYTE key[DES_BLOCK_SIZE * 3] = {
        0x01,0x23,0x45,0x67,0x89,0xAB,0xCD,0xEF,
        0x23,0x45,0x67,0x89,0xAB,0xCD,0xEF,0x01,
        0x45,0x67,0x89,0xAB,0xCD,0xEF,0x01,0x23};

    tdes_alg_ecb(pt,
                 DES_BLOCK_SIZE*8,
                 buf,
                 key,
                 DES_ENCRYPT);

    pass = !memcmp(ct, buf, DES_BLOCK_SIZE*8);

    printf("3DES ECB test: %s\n", pass ? "SUCCEEDED" : "FAILED");

    return 0;
}

static int test_tdes_cbc(void)
{
    int pass = 1;

    BYTE pt[DES_BLOCK_SIZE*2]    = {
        0x54,0x69,0x87,0x53,0x21,0x45,0x60,0x45,
        0x54,0x69,0x87,0x53,0x21,0x45,0x60,0x45};

    BYTE ct[DES_BLOCK_SIZE*2]    = {
        0xd1,0x97,0xf8,0xeb,0xf7,0x45,0x51,0xeb,
        0xef,0xab,0xe7,0x7b,0xc0,0xa2,0x50,0xc1};

    BYTE buf[DES_BLOCK_SIZE*2];

    BYTE key[DES_BLOCK_SIZE*3]    = {
        0x59,0x87,0x42,0x36,0x51,0x45,0x69,0x87,
        0x59,0x87,0x42,0x36,0x51,0x45,0x69,0x87,
        0x59,0x87,0x42,0x36,0x51,0x45,0x69,0x87};
    BYTE iv[DES_BLOCK_SIZE]     = {
        0xab,0xf7,0x15,0x88,0x09,0xcf,0x4f,0x3c};

    tdes_alg_cbc(iv,
                 pt,
                 DES_BLOCK_SIZE*2,
                 buf,
                 key,
                 DES_ENCRYPT);

    pass = !memcmp(ct, buf, DES_BLOCK_SIZE*2);

    printf("3DES CBC test: %s\n", pass ? "SUCCEEDED" : "FAILED");

    return 0;
}

